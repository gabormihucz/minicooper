image: blang/latex
build:
  before_script:
    - virtualenv -p python3 venv
    - . venv/bin/activate
    - python -V
    - sudo apt-get update
    - sudo apt update
    - sudo apt -y install tesseract-ocr
    - sudo apt -y install libtesseract-dev
    - sudo apt -y install zip
  script:
    - pip install -r dependencies.txt
    - pip list
    - cd MCapp
    - python3 tests.py
    - cd ..
    - sudo python3 MCweb/MCwebDjango/manage.py makemigrations
    - sudo python3 MCweb/MCwebDjango/manage.py migrate
    - sudo python3 MCweb/MCwebDjango/populate.py
    - sudo python3 MCweb/MCwebDjango/manage.py test
    - latexmk -pdf -cd docs/dissertation/dissertation.tex
    - sudo rm -r venv/
    - zip -r deployment.zip ../dissertation
  artifacts:
    paths:
      - "*.pdf"
      - "*.zip"
